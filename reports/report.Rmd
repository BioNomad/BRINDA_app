---
title: "`r params$title`"
date: "`r format(Sys.time(), '%d %B, %Y')`" 
output: html_document
params:
  title: BRINDA Adjustment Report
  data: NULL
  plot: NULL
  rbp: NULL
  rt: NULL
  ft: NULL
  stfr: NULL
  zn: NULL
  agp: NULL
  crp: NULL
  pop: NULL
  rbpC: NULL
  rtC: NULL
  ftC: NULL
  stfrC: NULL
  zn_morn_fast_C : NULL
  zn_morn_nonfast_C : NULL
  zn_after_nonfast_C : NULL
  initCut: NULL
  refAgp : NULL
  refCrp :  NULL
  adjBar : NULL
  defBar : NULL
  stats : NULL
  density : NULL
---

## Input Data

The input data has `r nrow(params$data)` samples and `r ncol(params$data)` observations per sample. The following biomarkers were assigned to the column names listed below and had the following statistics:

```{r results='asis',echo=FALSE}
library(kableExtra)
knitr::kable(params$stats, format = "html") %>%
  kable_styling()
```


## Initial Deficiency Cutoff

The following cutoff was applied to the biomarkers below. Biomarkers with a level below the cutoff were considered deficient prior to the BRINDA adjustment:

| Biomarker | Value Cutoff |
|-|-|
| Retinol Binding Protein| `r params$rbpC` |
| Retinol | `r params$rtC` |
| Ferritin | `r params$ftC` |
| Soluble Transferrin Receptor | `r params$stfrC` |
| Zinc Morning/Fasting Cutoff | `r params$zn_morn_fast_C` |
| Zinc Morning/Non-Fasting Cutoff | `r params$zn_morn_nonfast_C` |
| Zinc Afternoon/Non-Fasting Cutoff | `r params$zn_after_nonfast_C` |
| AGP | 1 |
| CRP | 5 |



```{r cutoff,echo=FALSE,warning=F,message=FALSE}
library(patchwork)
library(ggplot2)

params$initCut
```

## Population Group

Biomarker values are adjusted per population group and as such reference AGP and CRP values are set accordingly. The population group, reference AGP, and reference CRP were set to the following:

```{r population,echo=FALSE,warning=F,message=FALSE}
population = params$pop
if(population == "PSC"){
  refAgp = "-0.52"
  refCrp = "-2.26"
}else if(population == "WRA"){
  refAgp = "-0.62"
  refCrp = "-1.83"
}else if(population == "Manual"){
  refAgp = "lowest decile of AGP"
  refCrp = "lowest decile of CRP"
}else if(population == "Other"){
  refAgp = params$refAgp
  refCrp = params$refCrp
}
```

* Population : `r population`
* Reference AGP : `r refAgp`
* Reference CRP : `r refCrp`

## BRINDA Adjustment

The biomarker values have been adjusted and the difference between adjusted and unadjusted values are displayed below:

```{r adjustment,echo=FALSE,warning=F,message=FALSE}
library(patchwork)
params$adjBar/params$density
```

Deficiency has been recalculated below after applying the BRINDA adjustment:

```{r defAdj,echo=FALSE,warning=F,message=FALSE}
library(patchwork)
params$defBar
```
